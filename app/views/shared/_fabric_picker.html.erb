<div class="inline-block my-5 relative" 
     data-controller="dropdown fabric-picker-nav"
     data-action="fabric-picker-nav:colorSelected->fabric-preview#handleColorSelected">
  <%# Picker button %>
  <button type="button"
          data-fabric-picker-button
          data-action="click->dropdown#toggle click->fabric-picker-nav#resetToRoot"
    class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all cursor-pointer bg-base-100 text-base-content ring-1 ring-base-content/20">
    <span data-fabric-indicator
          class="w-4 h-4 rounded-full transition-all ring-1 ring-inset ring-base-content/30 ring-dashed">
    </span>
    <span data-fabric-label>Preview on fabric</span>
    <%= icon(:chevron_down_outline, css_class: "size-4 text-base-content/90 transition-transform", data: { dropdown_target: "icon" }) %>
  </button>

  <%# Dropdown menu with sliding panels %>
  <div data-dropdown-target="menu"
       data-fabric-picker-nav-target="container"
       class="hidden absolute top-full left-0 mt-2 w-72 bg-base-100 rounded-xl shadow-xl ring-1 ring-base-content/10 z-50 overflow-hidden">

    <%# Panels wrapper - slides horizontally %>
    <div data-fabric-picker-nav-target="slider"
         class="flex transition-transform duration-300 ease-in-out h-full">

      <%# ===== PANEL 1: Root menu ===== %>
      <div class="w-72 shrink-0" data-fabric-picker-nav-target="panel" data-panel="root">
        <div class="py-2">

          <%# Recently used %>
          <div data-fabric-picker-nav-target="recentSection" class="hidden">
            <div class="px-4 py-1.5">
              <span class="text-xs font-medium text-base-content/50 uppercase tracking-wider">Recently used</span>
            </div>
            <div data-fabric-picker-nav-target="recentList">
              <%# Recent items loaded dynamically %>
            </div>
            <div class="h-px bg-base-content/10 my-2"></div>
          </div>

          <%# Default option (shown when fabric is active) %>
          <div data-fabric-preview-target="defaultOption" class="hidden">
            <button type="button"
                    data-action="click->fabric-preview#reset click->dropdown#close"
              class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
              <span class="w-5 h-5 rounded-full border-2 border-dashed border-base-content/70"></span>
              <span class="text-base-content">Reset</span>
            </button>
            <div class="h-px bg-base-content/10 my-2"></div>
          </div>

          <%# Custom color picker %>
          <label class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm hover:bg-base-200 transition-colors cursor-pointer">
            <span class="w-5 h-5 rounded-full bg-linear-to-br from-red-400 via-yellow-400 to-blue-400"></span>
            <span class="text-base-content">Custom color...</span>
            <input type="color" 
                   class="sr-only"
                   data-action="input->fabric-preview#applyCustomColor change->dropdown#close">
          </label>

          <div class="h-px bg-base-content/10 my-2"></div>

          <%# Browse options %>

          <%# Fabric presets %>
          <button type="button"
              data-action="click->fabric-picker-nav#goToPanel"
            data-target-panel="presets"
            class="w-full flex items-center justify-between px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <span class="text-base-content">Fabric presets</span>
            <%= icon(:chevron_right_outline, css_class: "size-4 text-base-content/50") %>
          </button>

          <%# Browse color charts %>
          <button type="button"
                  data-action="click->fabric-picker-nav#goToPanel"
            data-target-panel="charts-brands"
            class="w-full flex items-center justify-between px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <span class="text-base-content">Choose from color charts</span>
            <%= icon(:chevron_right_outline, css_class: "size-4 text-base-content/50") %>
          </button>

          <%# Browse stash %>
          <button type="button"
                  data-action="click->fabric-picker-nav#goToPanel"
            data-target-panel="stash-families"
            class="w-full flex items-center justify-between px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <span class="text-base-content">Choose from your stash</span>
            <%= icon(:chevron_right_outline, css_class: "size-4 text-base-content/50") %>
          </button>
        </div>
      </div>

      <%# ===== PANEL: Fabric presets ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="presets">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
            data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div class="flex-1 overflow-y-auto pb-2">
          <% fabric_presets.each do |fabric| %>
            <button type="button"
              data-action="click->fabric-preview#selectFabric click->dropdown#close"
              data-fabric-hex="<%= fabric[:hex] %>"
              data-fabric-lightness="<%= fabric[:oklch_l] %>"
              data-fabric-preview-target="presetOption"
              class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
              <span class="w-5 h-5 rounded-full ring-1 ring-inset ring-base-content/20"
              style="background-color: <%= fabric[:hex] %>;"></span>
              <span class="text-base-content"><%= fabric[:name] %></span>
            </button>
          <% end %>
        </div>
      </div>

      <%# ===== PANEL 2a: Color Charts > Brands ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="charts-brands">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
                  data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div data-fabric-picker-nav-target="chartsBrandsList" class="flex-1 overflow-y-auto pb-2 text-sm text-base-content/50">
          <span class="px-4">Loading brands...</span>
        </div>
      </div>

      <%# ===== PANEL 2b: Stash > Color families ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="stash-families">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
                  data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div data-fabric-picker-nav-target="stashFamiliesList" class="flex-1 overflow-y-auto pb-2 text-sm text-base-content/50">
          <span class="px-4">Loading stash...</span>
        </div>
      </div>

      <%# ===== PANEL 3a: Color charts > Brand > Color families ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="charts-families">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
                  data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium" data-fabric-picker-nav-target="chartsBrandTitle">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div data-fabric-picker-nav-target="chartsFamiliesList" class="flex-1 overflow-y-auto pb-2 text-sm text-base-content/50">
          <span class="px-4">Loading color families...</span>
        </div>
      </div>

      <%# ===== PANEL 3b: Stash > Color families > Colors ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="stash-colors">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
                  data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium" data-fabric-picker-nav-target="stashFamilyTitle">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div data-fabric-picker-nav-target="stashColorsList" class="flex-1 overflow-y-auto pb-2 text-sm text-base-content/50">
          <span class="px-4">Loading colors...</span>
        </div>
      </div>

      <%# ===== PANEL 4a: Color charts > Brand > Color Families > Colors ===== %>
      <div class="w-72 shrink-0 flex flex-col max-h-96" data-fabric-picker-nav-target="panel" data-panel="charts-colors">
        <%# Fixed header %>
        <div class="shrink-0 py-2">
          <button type="button"
            data-action="click->fabric-picker-nav#goBack"
            class="w-full flex items-center gap-2 px-4 py-2.5 text-left text-sm hover:bg-base-200 cursor-pointer transition-colors">
            <%= icon(:arrow_left_outline, css_class: "size-4 text-base-content/70") %>
            <span class="text-base-content font-medium" data-fabric-picker-nav-target="chartsFamilyTitle">Back</span>
          </button>
          <div class="h-px bg-base-content/10 my-2"></div>
        </div>

        <%# Scrollable content %>
        <div data-fabric-picker-nav-target="chartsColorsList" class="flex-1 overflow-y-auto pb-2 text-sm text-base-content/50">
          <span class="px-4">Loading colors...</span>
        </div>
      </div>

    </div>
  </div>
</div>
