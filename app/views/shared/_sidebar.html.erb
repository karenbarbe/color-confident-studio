<aside data-controller="sidebar" 
       data-sidebar-target="sidebar"
       data-action="mouseenter->sidebar#expand mouseleave->sidebar#collapse"
  class="sidebar hidden md:flex fixed top-0 left-0 bottom-0 bg-base-100 border-r border-base-content/20 flex-col py-2 z-50">

  <%# Logo %>
  <div class="h-16 px-0 flex items-center w-full">
    <%= link_to root_path,
      class: "sidebar-logo-link flex items-center h-10 rounded-lg w-full min-w-0 overflow-hidden" do %>
      <span class="sidebar-icon sidebar-logo-icon">
        <%= render "shared/logo_isotype" %>
      </span>
      <span class="sidebar-label sidebar-logo-label font-semibold text-lg leading-none truncate">
        Color Confident
      </span>
    <% end %>
  </div>

  <%# Search bar %>
  <div class="px-3 h-16 flex flex-col justify-center overflow-hidden">
    <div class="sidebar-label">
      <label class="input input-bordered input-sm flex items-center gap-2 w-full">
        <%= icon(:search_outline, css_class: "size-4 opacity-50") %>
        <input type="text" 
               placeholder="Search colors, palettes..." 
               class="grow bg-transparent border-none focus:outline-none text-sm" />
      </label>
    </div>
  </div>

  <%# Navigation items %>
  <nav class="flex-1 flex flex-col py-2 px-2">
    <ul class="flex flex-col gap-1 flex-1">
      <%# Home %>
      <li>
        <%= link_to dashboard_path, 
            class: sidebar_nav_classes(:home), 
            title: "Home" do %>
          <span class="sidebar-icon">
            <%= icon(:home_outline, css_class: "size-6") %>
          </span>
          <span class="sidebar-label">Home</span>
        <% end %>
      </li>

      <%# Browse %>
      <li>
        <%= link_to color_charts_path, 
            class: sidebar_nav_classes(:browse), 
            title: "Browse" do %>
          <span class="sidebar-icon">
            <%= icon(:swatch_outline, css_class: "size-6") %>
          </span>
          <span class="sidebar-label">Browse</span>
        <% end %>
      </li>

      <%# Create  %>
      <li>
        <% if policy(Palette).create? %>
          <%= button_to palettes_path, 
            method: :post, 
            class: sidebar_nav_classes(:create), 
            title: "Create", 
            form: { class: "w-full" }, 
            data: { turbo: false } do %>
            <span class="sidebar-icon">
              <%= icon(:create_outline, css_class: "size-6") %>
            </span>
            <span class="sidebar-label">Create</span>
          <% end %>
        <% end %>
      </li>

      <%# Stash %>
      <li>
        <%= link_to stash_items_path, 
            class: sidebar_nav_classes(:stash), 
            title: "Stash" do %>
          <span class="sidebar-icon">
            <%= icon(:heart_outline, css_class: "size-6") %>
          </span>
          <span class="sidebar-label">Stash</span>
        <% end %>
      </li>

      <%# Palettes %>
      <li>
        <%= link_to palettes_path, 
            class: sidebar_nav_classes(:palettes), 
            title: "Palettes" do %>
          <span class="sidebar-icon">
            <%= icon(:palette_outline, css_class: "size-6") %>
          </span>
          <span class="sidebar-label">Palettes</span>
        <% end %>
      </li>

      <%# More %>
      <li class="dropdown dropdown-right" data-sidebar-target="dropdown">
        <div tabindex="0" 
             role="button" 
             class="flex items-center gap-3 h-10 px-3 rounded-lg cursor-pointer transition-colors text-base-content/70 hover:bg-base-content/5 hover:text-base-content" 
             title="More">
          <span class="sidebar-icon">
            <%= icon(:ellipsis_horizontal_outline, css_class: "size-6") %>
          </span>
          <span class="sidebar-label">More</span>
        </div>
        <ul tabindex="0" class="dropdown-content z-50 w-48 p-2 ml-2 bg-base-100 rounded-lg shadow-lg border border-base-300">
          <li class="px-3 py-1.5 text-xs uppercase tracking-wider text-base-content/50 font-medium">Coming soon</li>
          <li>
            <span class="flex items-center gap-2 px-3 py-2 rounded-md text-sm text-base-content/40 cursor-not-allowed">
              Settings
            </span>
          </li>
          <li>
            <span class="flex items-center gap-2 px-3 py-2 rounded-md text-sm text-base-content/40 cursor-not-allowed">
              Help
            </span>
          </li>
        </ul>
      </li>
    </ul>

    <%# User profile %>
    <div class="mt-auto pt-2">
      <div class="dropdown dropdown-top w-full" data-sidebar-target="dropdown">
        <div tabindex="0" 
             role="button" 
             class="flex items-center gap-3 h-12 px-3 rounded-lg cursor-pointer transition-colors text-base-content/70 hover:bg-base-content/5 hover:text-base-content w-full" 
             title="<%= Current.user.first_name %>">
          <span class="sidebar-icon">
            <%# User initials avatar %>
            <div class="size-9 rounded-full bg-linear-to-br from-primary to-secondary flex items-center justify-center shrink-0">
              <span class="text-sm font-medium text-primary-content"><%= user_initials(Current.user) %></span>
            </div>
          </span>
          <span class="sidebar-user-info">
            <span class="truncate font-medium text-sm text-base-content"><%= Current.user.first_name %></span>
            <span class="truncate text-xs text-base-content/60"><%= Current.user.email_address %></span>
          </span>
        </div>
        <ul tabindex="0" class="dropdown-content z-50 w-48 p-2 bg-base-100 rounded-lg shadow-lg border border-base-300">
          <li>
            <%= link_to user_path(Current.user), 
                class: "flex items-center gap-2 px-3 py-2 rounded-md text-sm text-base-content/80 hover:bg-base-content/5 hover:text-base-content transition-colors" do %>
              <%= icon(:user_outline, css_class: "size-4") %>
              Profile
            <% end %>
          </li>
          <li>
            <%= button_to session_path, 
                method: :delete, 
                class: "flex items-center gap-2 px-3 py-2 rounded-md text-sm text-base-content/80 hover:bg-base-content/5 hover:text-base-content transition-colors w-full text-left", 
                form: { class: "contents" }, 
                data: { turbo: false } do %>
              <%= icon(:sign_out_outline, css_class: "size-4") %>
              Sign out
            <% end %>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</aside>
