<% content_for :title, @palette.name.presence || "Palette" %>

<div class="mx-auto w-full mt-8 pb-8 space-y-6">

  <%# Flash messages %>
  <% if notice %>
    <div class="bg-green-50 text-green-700 px-4 py-3 rounded-lg">
      <%= notice %>
    </div>
  <% end %>

  <%# Header %>
  <div class="flex justify-between items-start">
    <div>
      <h1 class="font-bold text-2xl text-base-content"><%= @palette.name.presence || "Untitled palette" %></h1>
      <% if @palette.description.present? %>
        <p class="text-base-content/70 mt-1"><%= @palette.description %></p>
      <% end %>
    </div>
    <div class="flex gap-2">
      <% if policy(@palette).edit? %>
        <%= link_to "Edit", edit_palette_path(@palette), class: "btn btn-ghost btn-sm" %>
      <% end %>
    </div>
  </div>

  <%# Full palette preview %>
  <div class="bg-base-100 overflow-hidden">
    <%# Background with colors on top %>
    <div class="h-64 sm:h-80" style="background-color: #<%= @palette.background_color&.hex_color || 'f5f5f5' %>;">
      <%# Color swatches arranged on background %>
      <div class="flex items-center p-8">
        <div class="flex gap-2">
          <% @palette.thread_slots.each do |slot| %>
            <div class="aspect-1/4 h-40 sm:h-60 rounded-full"
                 style="background-color: #<%= slot.product_color.hex_color %>;"
                 title="<%= slot.product_color.vendor_code %>">
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Color details %>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

    <%# Background %>
    <div class="bg-base-100 rounded-xl p-5">
      <h3 class="font-semibold text-base-content mb-3">Background</h3>
      <% if @palette.background_color %>
        <% color = @palette.background_color %>
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-lg "
               style="background-color: #<%= color.hex_color %>;"></div>
          <div>
            <p class="font-medium text-base-content"><%= color.vendor_code %></p>
            <p class="text-sm text-base-content/70"><%= color.name %></p>
            <p class="text-xs text-base-content/50"><%= color.brand.name %></p>
          </div>
        </div>
      <% end %>
    </div>

    <%# Thread colors %>
    <div class="bg-base-100 rounded-xl p-5">
      <h3 class="font-semibold text-base-content mb-3">Thread colors</h3>
      <div class="space-y-2">
        <% @palette.thread_slots.each do |slot| %>
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg"
                 style="background-color: #<%= slot.product_color.hex_color %>;"></div>
            <div>
              <p class="font-medium text-base-content text-sm"><%= slot.product_color.vendor_code %></p>
              <p class="text-xs text-base-content/70"><%= slot.product_color.name %></p>
              <p class="text-xs text-base-content/50"><%= slot.product_color.brand.name %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>

  </div>

  <%# Actions %>
  <div class="flex justify-between items-center pt-4">
    <%= link_to "Back to palettes", palettes_path, class: "btn btn-outline" %>

    <% if policy(@palette).destroy? %>
      <%= button_to "Delete palette",
          palette_path(@palette),
          method: :delete,
          class: "btn btn-outline text-red-600",
          data: { turbo_confirm: "Are you sure you want to delete this palette?" } %>
    <% end %>
  </div>

</div>
