<% content_for :title, @palette.name.presence || "Create palette" %>

<div class="mx-auto w-full mt-8 pb-8 space-y-6">

  <%# Header %>
  <div class="flex justify-between items-center">
    <div>
      <h1 class="font-bold text-2xl text-gray-900">
        <%= @palette.draft? ? "Create palette" : "Edit palette" %>
      </h1>
    </div>
    <%= link_to "Cancel", palettes_path, class: "btn btn-ghost btn-sm" %>
  </div>

  <%# Flash messages %>
  <% if alert %>
    <div class="bg-red-50 text-red-700 px-4 py-3 rounded-lg">
      <%= alert %>
    </div>
  <% end %>

  <% if notice %>
    <div class="bg-green-50 text-green-700 px-4 py-3 rounded-lg">
      <%= notice %>
    </div>
  <% end %>

  <%# Palette name and description form %>
  <%= form_with(model: @palette, url: palette_path(@palette), method: :patch, class: "space-y-4") do |form| %>
    <div class="bg-base-100 rounded-xl shadow-sm p-5 space-y-4">
      <div>
        <%= form.label :name, "Palette name", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :name,
            placeholder: "Give your palette a name...",
            class: "input input-bordered w-full" %>
      </div>

      <div>
        <%= form.label :description, "Description (optional)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_area :description,
            placeholder: "What's this palette for?",
            rows: 2,
            class: "textarea textarea-bordered w-full" %>
      </div>

      <div class="flex justify-end">
        <%= form.submit "Update", class: "btn btn-sm btn-ghost" %>
      </div>
    </div>
  <% end %>

  <%# Color sections %>
  <div class="space-y-4">

    <%# Background section %>
    <%= render "palette_section",
        palette: @palette,
        section: "background",
        title: "Background",
        subtitle: "Choose 1 fabric color as your base",
        slots: @background_slots,
        min: 1,
        max: 1 %>

    <%# Main colors section %>
    <%= render "palette_section",
        palette: @palette,
        section: "main",
        title: "Main colors",
        subtitle: "Your dominant colors (1-6)",
        slots: @main_slots,
        min: 1,
        max: 6 %>

    <%# Secondary colors section %>
    <%= render "palette_section",
        palette: @palette,
        section: "secondary",
        title: "Secondary colors",
        subtitle: "Supporting colors (1-4)",
        slots: @secondary_slots,
        min: 1,
        max: 4 %>

    <%# Accent colors section %>
    <%= render "palette_section",
        palette: @palette,
        section: "accent",
        title: "Accent colors",
        subtitle: "Pop of contrast (1-2)",
        slots: @accent_slots,
        min: 1,
        max: 2 %>

  </div>

  <%# Save button %>
  <div class="bg-base-100 rounded-xl shadow-sm p-5">
    <% if @palette.can_publish? %>
      <%= button_to "Save palette",
          publish_palette_path(@palette),
          method: :patch,
          params: { palette: { name: @palette.name, description: @palette.description } },
          class: "btn btn-primary w-full" %>
    <% else %>
      <div class="space-y-3">
        <button class="btn btn-primary w-full" disabled>Save palette</button>
        <div class="text-sm text-gray-500">
          <p class="font-medium mb-1">To save your palette, you need:</p>
          <ul class="list-disc list-inside space-y-0.5">
            <% @palette.missing_requirements.each do |req| %>
              <li><%= req %></li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>
  </div>

  <%# Delete draft %>
  <% if @palette.draft? %>
    <div class="text-center">
      <%= button_to "Delete draft",
          palette_path(@palette),
          method: :delete,
          class: "btn btn-ghost btn-sm text-red-600",
          data: { turbo_confirm: "Are you sure you want to delete this draft?" } %>
    </div>
  <% end %>

</div>
