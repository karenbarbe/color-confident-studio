<%# locals: (palette:, thread_slots:) %>

<% max_slots = Palette::SLOT_LIMITS["thread"][:max] %>
<% is_full = thread_slots.length >= max_slots %>

<div id="color-pills-container" class="flex items-end gap-3 overflow-x-auto pb-4" data-palette-editor-target="pillsContainer">

  <%# Existing color pills %>
  <% thread_slots.each_with_index do |slot, index| %>
    <div class="flex flex-col items-center gap-2 shrink-0">
      <%# The pill %>
      <button type="button"
              class="w-[100px] sm:w-[120px] h-[300px] sm:h-[360px] rounded-full shadow-lg transition-all hover:scale-105 focus:outline-none focus:ring-4 focus:ring-zinc-900/20 <%= 'ring-1 ring-inset ring-white/20' unless slot.product_color.oklch_l && slot.product_color.oklch_l >= 0.9 %>"
              style="background-color: #<%= slot.product_color.hex_color %>;"
              data-action="click->palette-editor#editColor"
        data-slot-id="<%= slot.id %>"
        data-color-id="<%= slot.product_color.id %>"
        data-hex="<%= slot.product_color.hex_color %>"
        data-vendor-code="<%= slot.product_color.vendor_code %>"
        data-name="<%= slot.product_color.name %>"
        data-brand-name="<%= slot.product_color.brand.name %>"
        data-palette-editor-target="colorPill"
        title="<%= slot.product_color.vendor_code %> - <%= slot.product_color.name %>">
      </button>

      <%# Selection indicator (shown when this pill is selected) %>
      <div class="h-2 w-12 rounded-full bg-zinc-900 opacity-0 transition-opacity"
           data-palette-editor-target="indicator"
           data-slot-id="<%= slot.id %>">
      </div>
    </div>
  <% end %>

  <%# Add new color placeholder %>
  <% unless is_full %>
    <div class="flex flex-col items-center gap-2 shrink-0">
      <button type="button"
              class="w-[100px] sm:w-[120px] h-[300px] sm:h-[360px] rounded-full border-2 border-dashed border-zinc-900/30 flex items-center justify-center hover:border-zinc-900/50 hover:bg-zinc-900/5 transition-all focus:outline-none focus:ring-4 focus:ring-zinc-900/20"
              data-action="click->palette-editor#addColor"
        data-palette-editor-target="addButton">
        <div class="size-12 rounded-full bg-zinc-900/10 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-6 text-zinc-900/50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
          </svg>
        </div>
      </button>

      <%# Empty indicator space for alignment %>
      <div class="h-2 w-12"></div>
    </div>
  <% end %>

</div>
