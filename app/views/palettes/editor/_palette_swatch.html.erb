<%# locals: (color:, type:, mode: "add", current_slot: nil, is_selected: false, background_hex: nil) %>

<%
  # Determine the action based on type
  action = type == "fabric" ? "palette-editor#selectBackgroundColor" : "palette-editor#selectThreadColor"
  
  card_width = "w-28"
  color_height = "h-20"
%>

<button type="button"
        class="shrink-0 group text-left disabled:cursor-default"
        data-action="click-><%= action %>"
  data-color-id="<%= color.id %>"
  data-hex="<%= color.hex_color %>"
  data-vendor-code="<%= color.vendor_code %>"
  data-name="<%= color.name %>"
  data-brand-name="<%= color.brand.name %>"
  data-color-family="<%= color.color_family %>"
  <% if type == "thread" %>data-oklch-l="<%= color.oklch_l %>"<% end %>
  data-mode="<%= mode %>"
  data-slot-id="<%= current_slot&.id %>"
  <%= "disabled" if is_selected %>>
  <div class="<%= card_width %> rounded-lg overflow-hidden bg-base-100 shadow-sm transition-shadow
              <%= is_selected ? 'ring-2 ring-base-content' : 'hover:shadow-md' %>">

    <%# Color preview area %>
    <div class="<%= color_height %> relative"
         style="background-color: #<%= color.hex_color %>;">

      <% if is_selected %>
        <%# Selected state: checkmark overlay %>
        <div class="absolute inset-0 flex items-center justify-center bg-black/20">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-6 text-white" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
          </svg>
        </div>
      <% else %>
        <%# Hover state: action icon %>
        <div class="absolute top-1.5 right-1.5 size-6 bg-black/20 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <% if mode == "edit" %>
            <%# Checkmark for replace %>
            <svg xmlns="http://www.w3.org/2000/svg" class="size-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
          <% else %>
            <%# Plus for add %>
            <svg xmlns="http://www.w3.org/2000/svg" class="size-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
            </svg>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# Color info %>
    <div class="p-2">
      <p class="font-bold text-xs text-base-content truncate"><%= color.vendor_code %></p>
      <p class="text-xs text-base-content/70 truncate"><%= color.name %></p>
    </div>
  </div>
</button>
