<%# locals: (color:, type:, mode: "add", current_slot: nil, is_selected: false, background_hex: nil) %>

<%
  # Determine the action based on type
  action = type == "fabric" ? "palette-editor#selectBackgroundColor" : "palette-editor#selectThreadColor"
  
  card_width = "w-28"
  color_height = "h-20"
%>

<button type="button"
        class="shrink-0 group text-left cursor-pointer"
        data-action="click-><%= action %>"
  data-color-id="<%= color.id %>"
  data-hex="<%= color.hex_color %>"
  data-vendor-code="<%= color.vendor_code %>"
  data-name="<%= color.name %>"
  data-brand-name="<%= color.brand.name %>"
  data-color-family="<%= color.color_family %>"
  <% if type == "thread" %>data-oklch-l="<%= color.oklch_l %>"<% end %>
  data-mode="<%= mode %>"
  data-slot-id="<%= current_slot&.id %>"
  <%= "disabled" if is_selected %>>
  <div class="<%= card_width %> rounded-md overflow-hidden bg-base-100
              <%= is_selected ? 'ring-2 ring-base-content' : '' %>">

    <%# Color preview area %>
    <div class="<%= color_height %> relative"
         style="background-color: #<%= color.hex_color %>;">

      <% if is_selected %>
        <%# Selected state: checkmark overlay %>
        <div class="absolute inset-0 flex items-center justify-center bg-black/20 text-white">
          <%= icon(:check_outline, class: "size-4") %>
        </div>
      <% else %>
        <%# Hover state: action icon %>
        <div class="absolute top-1.5 right-1.5 size-6 bg-white/50 text-gray-900 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <% if mode == "edit" %>
            <%# Arrow path for replace %>
            <%= icon(:arrow_path_outline, css_class: "size-4") %>
          <% else %>
            <%# Plus for add %>
            <%= icon(:plus_outline, css_class: "size-4") %>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# Color info %>
    <div class="p-2">
      <p class="font-bold text-xs text-base-content truncate"><%= color.vendor_code %></p>
      <p class="text-xs text-base-content/70 truncate"><%= color.name %></p>
    </div>
  </div>
</button>
