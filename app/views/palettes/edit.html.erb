<% content_for :full_width_after do %>
  <%# Dynamic background style container %>
  <div id="background-layer-style">
    <style>
      [data-palette-editor-target="backgroundLayer"] {
        background-color: <%= @palette.background_color ? "##{@palette.background_color.hex_color}" : 'var(--color-base-200)' %>;
      }
    </style>
  </div>

  <div class="w-full -mt-16 md:-mt-8 -mb-16 min-h-screen pt-16 md:pt-8 pb-8 transition-colors duration-300 flex flex-col"
       data-controller="palette-editor palette-header-contrast"
       data-palette-editor-palette-id-value="<%= @palette.id %>"
       data-palette-editor-is-new-palette-value="<%= @palette.color_slots.empty? %>"
       data-palette-editor-target="backgroundLayer">

    <%# Flash messages container for Turbo Stream updates %>
    <div id="flash-messages" class="fixed top-4 right-4 z-100 space-y-2">
      <%= render "shared/flash", notice: notice, alert: alert %>
    </div>

    <%# Flex wrapper for main content + slide panel %>
    <div class="flex flex-1 min-h-0">

      <%# Main editor content %>
      <div class="flex-1 min-w-0 transition-all duration-300 flex flex-col">
        <%# Constrained content wrapper with vertical distribution %>
        <div class="mx-auto px-4 w-full flex-1 flex flex-col justify-between">

          <%# Header card - constrained width %>
          <div class="w-full max-w-2xl mx-auto">
            <%= render "palettes/editor/header", palette: @palette, thread_slots: @thread_slots %>
          </div>

          <%# Color pills area - centered vertically %>
          <div class="flex-1 flex items-center justify-center">
            <%= render "palettes/editor/color_pills_container",
                       palette: @palette,
                       thread_slots: @thread_slots %>
          </div>

          <%# Background selector - anchored to bottom %>
          <div class="flex justify-center pb-8">
            <%= render "palettes/editor/background_selector", palette: @palette %>
          </div>

        </div>
      </div>

      <%# Slide panel for color picker %>
      <%= render "shared/slide_panel",
                 frame_id: "editor_panel",
                 panel_id: "editor-panel-container",
                 auto_open: false,
                 header_partial: "palettes/editor/editor_panel_header",
                 close_callback: "palette-editor#onPanelClose" %>

    </div>

  </div>
<% end %>
